name: Deploy to Github Pages

on:
  push:
    branches: ["main", "master"]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: true

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Instalar htmlhint
        run: npm install -g htmlhint

      - name: Linting Profissional HTML

        run: htmlhint *.html

      - name: Explorando a Runner
        run: lsb_release -a && free -h
        

      - name: preparando versao de produção (build)
        run: |
          echo "Limpando instalações anteriores..."
          rm -rf dist
          
          echo "Criando a pasta dist do zero..."
          mkdir -p dist 
          
          echo "Copiando todos os arquivos HTML para a dist..."
          cp *.html dist/
          
          echo "Copiando a pasta assets inteira para a dist..."
          cp -r assets dist/ 2>/dev/null || echo "Aviso: pasta assets não encontrada"
          
          # Copiando itens extras do seu projeto original para não quebrar o visual
          cp -r img dist/ 2>/dev/null || true
          cp script.js dist/ 2>/dev/null || true
          
          echo "Listando o conteúdo da pasta dist para o log:"
          ls -R dist/

      - name: Auditoria de Qualidade
        run: |
          echo "Iniciando verificação de integridade dos arquivos..."
          test -f dist/index.html
          test -f dist/sobre.html
          test -f dist/contato.html
          echo "Auditoria concluída: Todos os arquivos essenciais estão na pasta dist!"


      - name: Setup Pages
        uses: actions/configure-pages@v4

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: 'dist'

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4

      - name: Mensagem Final
        run: echo "O código do aluno Davydson foi auditado, está seguindo as normas corretas e está pronto para o deploy!"